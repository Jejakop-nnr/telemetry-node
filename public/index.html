<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Telemetry Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { background: #0b0b0b; color: white; font-family: Arial; }
  h1 { text-align: center; }
  .chart-container { width: 90%; max-width: 1200px; margin: 20px auto; }
</style>
</head>
<body>
<h1>Rocket Telemetry</h1>

<div class="chart-container">
  <canvas id="heightChart"></canvas>
</div>
<div class="chart-container">
  <canvas id="speedChart"></canvas>
</div>
<div class="chart-container">
  <canvas id="tempChart"></canvas>
</div>

<script>
const heightCtx = document.getElementById('heightChart').getContext('2d');
const speedCtx = document.getElementById('speedChart').getContext('2d');
const tempCtx = document.getElementById('tempChart').getContext('2d');

const heightChart = new Chart(heightCtx, {
  type: 'line',
  data: { labels: [], datasets: [{ label: 'Height (m)', borderColor: '#00ffea', data: [], tension: 0.4 }]},
  options: { responsive: true, plugins: { legend: { color: 'white' } }, scales: { x: { ticks: { color: 'white' }}, y: { ticks: { color: 'white' }}} }
});
const speedChart = new Chart(speedCtx, {
  type: 'line',
  data: { labels: [], datasets: [{ label: 'Vertical Speed (m/s)', borderColor: '#ff0000', data: [], tension: 0.4 }]},
  options: { responsive: true, scales: { x: { ticks: { color: 'white' }}, y: { ticks: { color: 'white' }}} }
});
const tempChart = new Chart(tempCtx, {
  type: 'line',
  data: { labels: [], datasets: [{ label: 'Temperature (°C)', borderColor: '#ffff00', data: [], tension: 0.4 }]},
  options: { responsive: true, scales: { x: { ticks: { color: 'white' }}, y: { ticks: { color: 'white' }}} }
});

// Symulacja pobierania danych z serwera
async function fetchData() {
  try {
    const res = await fetch('https://telemetry-server-rmlj.onrender.com/telemetry');
    const data = await res.json();

    // dodaj nowe punkty do wykresów
    const time = new Date().toLocaleTimeString();
    heightChart.data.labels.push(time);
    heightChart.data.datasets[0].data.push(data.height);
    speedChart.data.labels.push(time);
    speedChart.data.datasets[0].data.push(data.verticalSpeed);
    tempChart.data.labels.push(time);
    tempChart.data.datasets[0].data.push(data.temperature);

    // ogranicz liczbę punktów do 50
    [heightChart, speedChart, tempChart].forEach(chart => {
      if(chart.data.labels.length > 50){
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
      }
      chart.update();
    });
  } catch(e){ console.error(e); }
}

setInterval(fetchData, 1000);
</script>
</body>
</html>
